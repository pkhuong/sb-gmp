(defpackage :sb-gmp-test (:use "COMMON-LISP" :it.bese.fiveam))

(in-package :sb-gmp-test)

(def-suite sb-gmp-suite :description "Unit tests for the GMP lib interface.")

(in-suite sb-gmp-suite)

;; Ensure to execute this, now that SB-GMP activates automatically!!!
(eval-when (:load-toplevel :execute)
  (sb-gmp:uninstall-gmp-funs)) 

(defparameter *state* (sb-gmp:make-gmp-rstate))
(sb-gmp:rand-seed *state* 1234)

(defmacro defgenerator (name arguments &body body)
  `(defun ,name ,arguments
     (lambda () ,@body)))

(defgenerator gen-mpz (&key (limbs 5))
  (sb-gmp:random-bitcount *state* (* limbs sb-vm:n-word-bits)))

(test mpz-add "Test the mpz-add function"
  (sb-gmp:rand-seed *state* 1234)
  (dotimes (i 5)
    (let ((limbs (+ (random #xFFFFF) 2)))
      (for-all ((neg-a (gen-integer :min 0 :max 1))
                (neg-b (gen-integer :min 0 :max 1))
                (a (gen-mpz :limbs limbs))
                (b (gen-mpz :limbs limbs)))
        (let ((ta (if (zerop neg-a) a (- a)))
              (tb (if (zerop neg-b) b (- b))))
          (is (= (+ ta tb)
                 (sb-gmp:mpz-add ta tb))))))))

(test mpz-sub "Test the mpz-sub function"
  (sb-gmp:rand-seed *state* 1234)
  (dotimes (i 5)
    (let ((limbs (+ (random #x1FFFF) 2)))
      (for-all ((neg-a (gen-integer :min 0 :max 1))
                (neg-b (gen-integer :min 0 :max 1))
                (a (gen-mpz :limbs limbs))
                (b (gen-mpz :limbs limbs)))
        (let ((ta (if (zerop neg-a) a (- a)))
              (tb (if (zerop neg-b) b (- b))))
          (is (= (- ta tb)
                 (sb-gmp:mpz-sub ta tb))))))))

(test mpz-mul "Test the mpz-mul function"
  (sb-gmp:rand-seed *state* 1234)
  (dotimes (i 5)
    (let ((limbs (+ (random #x253F) 2)))
      (for-all ((neg-a (gen-integer :min 0 :max 1))
                (neg-b (gen-integer :min 0 :max 1))
                (a (gen-mpz :limbs limbs))
                (b (gen-mpz :limbs limbs)))
        (let ((ta (if (zerop neg-a) a (- a)))
              (tb (if (zerop neg-b) b (- b))))
          (is (= (* ta tb)
                 (sb-gmp:mpz-mul ta tb))))))))

(test mpz-truncate "Test the mpz-tdiv function"
  (sb-gmp:rand-seed *state* 1234)
  (dotimes (i 5)
    (let ((limbs (+ (random #x253F) 2)))
      (for-all ((neg-a (gen-integer :min 0 :max 1))
                (neg-b (gen-integer :min 0 :max 1))
                (a (gen-mpz :limbs limbs))
                (b (gen-mpz :limbs limbs)))
        (let ((ta (if (zerop neg-a) a (- a)))
              (tb (if (zerop neg-b) b (- b))))
          (multiple-value-bind (ld lr)
              (truncate ta tb)
            (multiple-value-bind (gd gr)
                (sb-gmp:mpz-tdiv ta tb)
              (is (and (= ld gd)
                       (= lr gr))))))))))

(test mpz-floor "Test the mpz-fdiv function"
  (sb-gmp:rand-seed *state* 1234)
  (dotimes (i 5)
    (let ((limbs (+ (random #x253F) 2)))
      (for-all ((neg-a (gen-integer :min 0 :max 1))
                (neg-b (gen-integer :min 0 :max 1))
                (a (gen-mpz :limbs limbs))
                (b (gen-mpz :limbs limbs)))
        (let ((ta (if (zerop neg-a) a (- a)))
              (tb (if (zerop neg-b) b (- b))))
          (multiple-value-bind (ld lr)
              (floor ta tb)
            (multiple-value-bind (gd gr)
                (sb-gmp:mpz-fdiv ta tb)
              (is (and (= ld gd)
                       (= lr gr))))))))))

(test mpz-ceiling "Test the mpz-cdiv function"
  (sb-gmp:rand-seed *state* 1234)
  (dotimes (i 5)
    (let ((limbs (+ (random #x253F) 2)))
      (for-all ((neg-a (gen-integer :min 0 :max 1))
                (neg-b (gen-integer :min 0 :max 1))
                (a (gen-mpz :limbs limbs))
                (b (gen-mpz :limbs limbs)))
        (let ((ta (if (zerop neg-a) a (- a)))
              (tb (if (zerop neg-b) b (- b))))
          (multiple-value-bind (ld lr)
              (ceiling ta tb)
            (multiple-value-bind (gd gr)
                (sb-gmp:mpz-cdiv ta tb)
              (is (and (= ld gd)
                       (= lr gr))))))))))

(test mpz-gcd "Test the mpz-gcd function"
  (sb-gmp:rand-seed *state* 1234)
  (dotimes (i 5)
    (let ((limbs (+ (random #x253F) 2)))
      (for-all ((neg-a (gen-integer :min 0 :max 1))
                (neg-b (gen-integer :min 0 :max 1))
                (a (gen-mpz :limbs limbs))
                (b (gen-mpz :limbs limbs)))
        (let ((ta (if (zerop neg-a) a (- a)))
              (tb (if (zerop neg-b) b (- b))))
          (is (= (gcd ta tb)
                 (sb-gmp:mpz-gcd ta tb))))))))

(test mpz-lcm "Test the mpz-lcm function"
  (sb-gmp:rand-seed *state* 1234)
  (dotimes (i 5)
    (let ((limbs (+ (random #x253F) 2)))
      (for-all ((neg-a (gen-integer :min 0 :max 1))
                (neg-b (gen-integer :min 0 :max 1))
                (a (gen-mpz :limbs limbs))
                (b (gen-mpz :limbs limbs)))
        (let ((ta (if (zerop neg-a) a (- a)))
              (tb (if (zerop neg-b) b (- b))))
          (is (= (lcm ta tb)
                 (sb-gmp:mpz-lcm ta tb))))))))

(test mpz-isqrt "Test the mpz-isqrt function"
  (sb-gmp:rand-seed *state* 1234)
  (dotimes (i 5)
    (let ((limbs (+ (random #x253F) 2)))
      (for-all ((a (gen-mpz :limbs limbs)))
        (is (= (isqrt a)
               (sb-gmp:mpz-sqrt a)))))))

(test mpz-mod "Test the mpz-mod function"
  (sb-gmp:rand-seed *state* 1234)
  (dotimes (i 5)
    (let ((limbs (1+ (random #x253F))))
      (for-all ((neg-a (gen-integer :min 0 :max 1))
                (neg-b (gen-integer :min 0 :max 1))
                (a (gen-mpz :limbs limbs))
                (b (gen-mpz :limbs limbs)))
        (let ((ta (if (zerop neg-a) a (- a)))
              (tb (if (zerop neg-b) b (- b))))
          (is (= (mod ta (abs tb))
                 (sb-gmp:mpz-mod ta tb))))))))

(test mpz-powm "Test the mpz-powm function"
  (sb-gmp:rand-seed *state* 1234)
  (dotimes (i 5)
    (let ((limbs (1+ (random #x125))))
      (for-all ((neg-a (gen-integer :min 0 :max 1))
                (a (gen-mpz :limbs limbs))
                (m (gen-mpz :limbs (ceiling limbs 2))))
        (let ((e (sb-bignum:make-small-bignum (1+ (random 40))))
              (ta (sb-gmp::bassert (if (zerop neg-a) a (- a)))))
          (is (= (mod (expt ta e) m)
                 (sb-gmp:mpz-powm ta e m))))))))

(test fixed-bugs "Tests for found bugs"
  (is (= (+ #x7FFFFFFFFFFFFFFF #x7FFFFFFFFFFFFFFF)
         (sb-gmp:mpz-add #x7FFFFFFFFFFFFFFF #x7FFFFFFFFFFFFFFF)))
  (let ((a 30951488519636377404900619671461408624764773310745985021994671444676860083493)
        (b 200662724990805535745252242839121922075))
    (multiple-value-bind (ld lr)
        (truncate a b)
      (multiple-value-bind (gd gr)
          (sb-gmp:mpz-tdiv a b)
        (is (and (= ld gd)
                 (= lr gr))))))
  (let ((a 320613729464106236061704728914573914390)
        (b -285049280629101090500613812618405407883))
    (multiple-value-bind (ld lr)
        (truncate a b)
      (multiple-value-bind (gd gr)
          (sb-gmp:mpz-tdiv a b)
        (is (and (= ld gd)
                 (= lr gr)))))))

(test mpz-nextprime "Test the mpz-nextprime/mpz-probably-prime-p function"
  (sb-gmp:rand-seed *state* 6234)
  (let ((limbs (1+ (random #x2F))))
    (for-all ((a (gen-mpz :limbs limbs)))
      (let ((p (sb-gmp:mpz-nextprime a)))
        (is (>= p a))
        (is (> (sb-gmp:mpz-probably-prime-p p) 0))))))

(test mpq-add "Test the mpq-add function"
  (sb-gmp:rand-seed *state* 1235)
  (dotimes (i 5)
    (let ((limbs (1+ (random #x3FF))))
      (for-all ((neg-a (gen-integer :min 0 :max 1))
                (neg-b (gen-integer :min 0 :max 1))
                (an (gen-mpz :limbs limbs))
                (ad (gen-mpz :limbs limbs))
                (bn (gen-mpz :limbs limbs))
                (bd (gen-mpz :limbs limbs)))
        (let ((tan (if (zerop neg-a) an (- an)))
              (tbn (if (zerop neg-b) bn (- bn))))
          (is (= (+ (/ tan ad) (/ tbn bd))
                 (sb-gmp:mpq-add (/ tan ad) (/ tbn bd)))))))))

(test mpq-sub "Test the mpq-sub function"
  (sb-gmp:rand-seed *state* 1235)
  (dotimes (i 5)
    (let ((limbs (1+ (random #x1FF))))
      (for-all ((neg-a (gen-integer :min 0 :max 1))
                (neg-b (gen-integer :min 0 :max 1))
                (an (gen-mpz :limbs limbs))
                (ad (gen-mpz :limbs limbs))
                (bn (gen-mpz :limbs limbs))
                (bd (gen-mpz :limbs limbs)))
        (let ((tan (if (zerop neg-a) an (- an)))
              (tbn (if (zerop neg-b) bn (- bn))))
          (is (= (- (/ tan ad) (/ tbn bd))
                 (sb-gmp:mpq-sub (/ tan ad) (/ tbn bd)))))))))

(test mpq-mul "Test the mpq-mul function"
  (sb-gmp:rand-seed *state* 6235)
  (dotimes (i 5)
    (let ((limbs (1+ (random #x5FF))))
      (for-all ((neg-a (gen-integer :min 0 :max 1))
                (neg-b (gen-integer :min 0 :max 1))
                (an (gen-mpz :limbs limbs))
                (ad (gen-mpz :limbs limbs))
                (bn (gen-mpz :limbs limbs))
                (bd (gen-mpz :limbs limbs)))
        (let ((tan (if (zerop neg-a) an (- an)))
              (tbn (if (zerop neg-b) bn (- bn))))
          (is (= (* (/ tan ad) (/ tbn bd))
                 (sb-gmp:mpq-mul (/ tan ad) (/ tbn bd)))))))))

(test mpq-div "Test the mpq-div function"
  (sb-gmp:rand-seed *state* 7235)
  (dotimes (i 5)
    (let ((limbs (1+ (random #x3FF))))
      (for-all ((neg-a (gen-integer :min 0 :max 1))
                (neg-b (gen-integer :min 0 :max 1))
                (an (gen-mpz :limbs limbs))
                (ad (gen-mpz :limbs limbs))
                (bn (gen-mpz :limbs limbs))
                (bd (gen-mpz :limbs limbs)))
        (let ((tan (if (zerop neg-a) an (- an)))
              (tbn (if (zerop neg-b) bn (- bn))))
          (is (= (/ (/ tan ad) (/ tbn bd))
                 (sb-gmp:mpq-div (/ tan ad) (/ tbn bd)))))))))

(test mpq-lmj "Test failure found by Jams M. Lawrence"
      (let ((tan 937809854159418053698598320140258537535408849865415972582434573079445482208630655989111919742290500110872910167353568429998313986651765994920595379371112573373075397951260542759644038134654381274640766403069336672809336034467544024179529362810071290325610443885807402335424070512755598476183598294996879178657230109982828167810446592185213794634816912206708847963849913170049856011421073730170437246823486969654494958440258264175814965691120174177249586685124162292817311897861726631719031567715867050359728393814302134900210011313593790809848327788604306808580392513546186669801285026892506831060637422184101431484541287788251957630645702727424521487178482528320831640948735224331191585762723364608731233134342456395891250862811925360709271334078329380007863058025485767055175680104088844862037107004050744032772938894950136544385679989174836152453317969686446181065798616814983793251630407459567106067659960399691624820082928192985910383495656229437403789829637902176119176207696323738207869676404539875538823655486419337575197805456069782516105866396032593633627947099059373886505764024044212590521141001388169578776836451721751295558087465305472673767158976423220912483512907662090888757896868587739264082279750744838540573477793799437960594713873384614223105769504608133976175096792175699909755836740965351748972657534424705672446799645209017902416217865394128485982124184154001806429463105328847470957809752498246122702181368765875397711925673282202968873143519031185594695473070164233807577007628663609406907083597495798209351397116272359783501761585239274857385896173378479753664568519098551272103113190860011811316640273327145922711698085711744150527625989749334247928654445278775279030650311202503799973531906104717893377915745154567419487544531098455760844700523724767932793529645815880172927048342013655835066732501407909776645232425911418314865119371986327210040412841792709746665470285631901405253086534945013742308650005614922862258949445851858861273990023977479908087634887242953169461015974563039278431732986108467084551625479576534373042742201831186753641862628574009697987004953074734247274714625684897210810724615059178330425105778818164968066552266375726546587373858245121599198393331278592106671958001952459006990579822582091058925704780587556461243182376194729590668848731611618172524739119981458415524588957627379221253108618166070761254439642121691671589476374553740356962785655777926526037945513466920887645579910007962275391504216594794119919979117967932813005244695624763541505423055605310509479145532298181187882728408201484041408774149172191234369149893022193017479730761820619874920613774704324919357464142244316386315204867851938114053746812368992047701133480937772985500996940885564322051510127376337035751314152843589168135016635266457618670317029993005124565949588683944607883649144574608827133884292025481926165237718176492520584495613393886823425525179699560693063951587084515755821578817162317314549664730443247826523674528429706594268730539496072575457135927370652252118861100150443006756135099486624202953602487032370879517177173947176665868663071732071658024492892229727786495207439822521811851926648347828826140883961669391366671005630701134058957452873529726062920205534429947387993198024278567059038108339642343688180641708587495857582564526822178977412820039239607583242048054863761100797139178995572605372838167681628773947794616218843453719924721922672762253760424489278836025444791995942008107741090839359391096525412564069764985196561708586486295842399900092001168468119090615885485848688623738325546860759118333687518026834354715084251649466581384311964699356951)
            (ad 1512263326078613129083593809466600424708886373771077165461805392834598698301299148442156893528072936289164534297723589017428459033258121545072282387007842565712794901242030054477032623302488135312284243384830583169645802193451851338567634936077556993745148610318964684588862229389689737455152859436396502180018520219264311196669716508488783381111147974977212078142977684298088359624224615373440536821381839955624414135279204965910604183938120299280994048746150022047746941393547347368894039948991553973963633353909759556408162704492766946308249861749406985632908741719049818728738834581740091381304434352859040734272300664750595850130065769031821013391690657906238908766086813206521213113122307621753207970184156638121597589287515335351187518620283874170388503778896847615355438902379765357323262435269024151269281861703430474283634087467323885922784187140603055534114025435482245143040736081578257857353671514269772866263498306958148129861442336807751291539828090134724509663817452585130432521344799005092468864682419519258825998304497617979344522810645486494028633051360219183326982786103214087403431033861330250042147821727086584221776196397933948337880393383587022150683123674451212672991323369207219792849980525540723895232129692965671682810421558179825422131867551381270949394893734291338038694535120146747131958229658135242448806763910252360916055341711472411605855613542873357506091225327286764768491025244357646570616436314025607668090822801255167582066227425567277630311593432841446544044572008970590326424704620713822555956057148968127099832731516273169814630796322915224772308113028972544308453699497033463271590578592786345691453155259878742095944957327961413247925421870595352361484660738396527757673296904893939040148648481720401371588231612352267005865677143945240067735455045284810129960732051157779831651072936011989935095831927105481058625080170110893058868251541190392026749646129785865410251920683737883300817221672323858806853472267426204914650401890868032200112356828894428244365895959252704986689980839236951482768342542092589530812849681670498278904246185765955181910414166496615317679552242431215325639801890670572840072512037726132997303578626970897495922716434084313240971441603040930748502336852448598754184245717423816376521794503174870874534084290955939988605627033366065192374546607498247055243631776702577354441504449768719276376440899545750318560407930827568156967919232968882782179811866110949815308678569835222294818345905331602380829418800155107158854315081289418258962649332003432593980136308764582991982603460369140762920900842287231504024678690697850512331531140711820492950301440564575972846897792549279966793119365611889133065685861278969077294580507621423616033925878516130944546256439905106658937425818883888205132837113638923281597471162457603081679655467382331602852282533472732493908477430739430391199606503489798945095421393532584625865515597172413875849791127551279528238856473999190050257569088337209396367936572602977233487098479637404936860088099265757828791040594235158314071946110247211768507897379247121478288822967068198431272811731933249540834574717949448248477215229548539313523124762337477520034302969094694285800865174782198864529420594025083106582087472709895585645749232644104677661594868683445980421730684883966100421060799139209796686456505733901728257666233465068301112728542910912825628738453651796378798909053723279702264566173749686080465459286779776078611458762061321531952454769382208362802661162254774120762741623409111120948198585355092218779206820889745196166536983263061977469445035814429482469524009892949834463762960112467035204393962154)
            (tbn -2037364951265117829521756324272721369675012787931466702661224038398665668006134256028639172631397488780474872102662336666407146979559413105039185203033616162307331143939188753267500201757951628005972918176798345737330887735979723983933219936834725386241378435737657538943969473503206295021060905969211287303243208984337898836991825021198771444444332929876010001592889620503605245413716200956491662930411392282818919306236146126841180513177282550352905861867554441661520326291178509603655738661687608474652345092820681723070499582215167589027113331862390421206548860508367399541789538877128367095126964252531501151432784026677630462811613477421474150773209688132220730645157600213368746866699084526962579290616160284501266539840960741509140411802698506628053077641214439854420366267121111434916979396848414929097638444300212463866673801758203039896648197631552392976939935134694984352352341126777792864988342867850759950923102943155278673679309648834803075389929485000726825814700138013245967664443841890538355974935070884819163029006882840923501027106502665211804380287073810359589329402618406005081444782200494950385429595617971721509485351530723841527008222612787187718664646377816780681653093885656883739749300783892792105936432345337146501029140113191084788084213137624371583724910060988316388587304891837129471232524393662084665337624858079492127928985978269974575374249829162318149036143589547400987106471620304741489311139721293766059719621286392221391979858239976322314674763493882173963714724411855855243958705932002493170016405297727263388970874204720877713916945250866910511973279137598903546756559496240157384732263871432303575535190494937811182841357000468877459328396644436508697539387417351214828818284425968538961846418392336747936729612717468953063320272457377448543508448687973287021672134117828032467420001867067780338525525780754527422551959635022841356904761345629693258966174243507109130035255429401344855932115953126446843120770968546386196087003642663387096638456571389295659139572704788622076931695582382939318010724277401466319174502870965101802693130416023077243995307641546613251583212359757019258630700834373351609213129873497857613985661099491396645054606953952037852423862534611584149606356722293046213441744930260559953893857412114278826033401171757563075002485257215489435512259310326881759797654658775104303316852143966457850031899683243963496532067562382310617722421343442098590319220305548247583191417784293339062504721161543082179410117285599220582298042133992435627572796580437257541495838315937826158814772906262567524663702012049859781007181336733972662486722987527414788470958906346841136343263062027654411008895494445390306909392098560743905318198238582669433258093639665488881943100722355515987784366005109603821598944603071203462929629991003048650819684309808652963937581766716204650272878970847949332638181199352531445409692281553301132987482447113042742329701707275681033205764755756739549604974173790112193868075148168131417172421580174676701541143688301973174540480686728666510788389171004547136243677601171357256901242700848338311138253842488797801985353274224613783436872036352296729933120107007113140499313258310630538575077452208188113888267917463643105300304816472376986294697828864915352319422933528458064059409126811294367405489298156094509148483800597217870857943937230868991994912493725657091590726528520598176552646712658779870296007125674696344523481458200970062325431760651617825578852897957002286246040822248229756617547121130924118338603981505269306986031419625747051258400856795051777215622285553762312406712499244424297702043064394155419355532544929)
            (bd 581133803545932103018026403703103170369393894838845440012839406193798429958204633680224983158404945743811761150066536763606831338766684543561752017441502948792100270306932032598399949364724540179688544958059355604679726154261492664413076468750653096908677337809045764317036824625933007416255021915874899886144969276451496949560298656684419039192697860948882031968697572323736556742087595919839674636958352718255949271309705782515537748796860081929670574488184267036498458636915254402803456010185626838655609604098909028584324202547936509864358330967173746315057143844948314941108985052177580518228084612265714054030640271757948812732048095025779689214018498541941637549299657166569436217083564383835799676577261041937286366792666976865112677274896134690341374157685983519219806038339835823506699768796492260010758180529664292090645973603901699659607126371317673155542691763664831869393291056819706660130481834404919992093775696969855813407897714007416505758289561913385767072132291311905016036892179379581530930119962374824887758755945890013806911361351006920811299344743033657834895523446478143627431453279431379673534362613271693866696598381386802523829090867605904263935975527809387430958044288705063665970880149287655618101746189247459229655756778269790072250433379487798072599156824501988498183527311814944627299119792319076968697471680122400115897955239317410776269726883338721238927784124256488911873821368615238821061074384485603136835034076019461338759998414121261723983831571020986163473989914973583408658495573718076983843257805708585308660657990716292552161636843226099279645066326595623045916341288509223225775476789176837229660072652485600031342659133966744228883741711083234927347859344041058622116567395909047689838860053125454770829507250124255104163783612564168190034130901470236259199075013712868416222762825425669608527781413358658913771041746278030275255635187529070146234814286102473137995615405290159518132131758422182114474432859475905019334116928374348720310369268148979204148280379438582546421489405001225150679101308722794587196088297696064240610232310915676491482987636643372110175881753591868296800010769203586767317477874279052342016996810679213359407891859392845169003829078105973320610830396822835937727818107725343259204652810965976888687001592544372193360169009235472960485252255788209658409689784307912128756628993507176496629079531273155910849082412797817584483898387909389278040180590687299861609636870631093819617418168034120478139530142042532891686075836503106841578605065484044905407896567565566028292227400416774412638512500429360156818593719680071261833042894541870621341347416141011025335615851906227212519924355487676641974283921012842884471377354395141127769105888392902277075586111576153722152908241825844876561705363245033591860634086415656083797999869395885601972623908648060075281708449634060215745374531735464766034409927716625446422080633611773694035092304830477956658609495642159863637369229448903537124170666082111054097506554312292550445908078246068298717420877908050197424834902621236318126725755830120255188871479627197645145580313842170743774695217728260328177531901202453451939227267561405180078382021969087268274419524390554933920777965053730573765864720629076463740735171905271738868686031527897517213206885556852035943047530868756630648094153936792049804130207605029547228366363943626715875980129736488463683645470428602112723766639994239965127327113500856872406930375484141246081309652170145997357969624258075426233091283118738316395013411993457058723325448386215673162406613953120783000746604963573174681018216537480632493734925511478409040627617604))
        (is (= (/ (/ tan ad) (/ tbn bd))
               (sb-gmp:mpq-div (/ tan ad) (/ tbn bd))))))

(test mpq-fail "Failure condition that was encountered during random testing (since resolved"
  (let ((an -13209053177313216326720071994575668671625946154424946979941042235025779609406066489124822060263741415731767909095535978759309084425875537563179113298131593713396775343237383458479781949550240630412701857403503233189863607072117930640826569182009206708933257720426339611012943709281997759942473045656872630494457723826960825086582617760738451841527423714294371807083373098832437021848589728037526905908672891882725056067884256042505048001986703119531737056795446226445664725837005863750123574298000192591001893057277178437857007262375095660896699217748352172606682055924706139632861269010372898134646451737590670614560649546844481697242528214535706357927544878674268030374370278308504509252394576207386344666818237571152429009824441574054780299582577801481767459654249022803191897258173315859493825673310472505293627476855369546650359583218498516377023038245685243868968780236437619483792036441607501402092965075649435802858970715108833831163596260720848064686538519339195183094001726352453705513582309597381501641400986633247524429625086995030279106454495104883103144972006136945504038625443714829393575431723477731391536529901691154731695666918250476276904458544458920225308813979815661628422015950374787964790294728431305560901981574526733321069031075413803807919559580147250764144945690106618011831706083014149915084399785240071376864007068579410836584583640124573636564525508781814067728494858869755462333538613864275409311494135416846021419052727382769669646774316183742088736319734577932969015168552780639091132865606483317081877017019863932502252092416408465358902183952810083840135676232857108681406486228546498252506817867584563688247332110215273151817829391150607426998926468854041744560970884608178439217990221993505915120441065973024578417594697614340421542869597391944892731436704363092556227861288542154533966853578546397006975240622959448425346779466724647279240015643799101159755851939673521288390733178144929994118609073425419299771438638154675479577257608964922414393526655389054776040890897127353109186990337860645391379224816579489224213787802841647588422060321741574667225867107935341545992758460567691834834677102164126543306712069736700806387259764413531457970954153801229449751018964914808807523738864401593622739672532046389168352737493963609733273138264236810210602108213237142407172633253427427858308191860601367964093868742916150428348086935533601815990061734949289335443255625406474502500919112688955733286467584667225159924898259902443424322015574285591785177463802961642299768433955323304169824647179428285450887144401989305402699455358336862489956755941197154511191311114593457064024159546112615698065878019110371636625550987691920666797008128403458483365368131571213824939808939703491750827705258225332786724552178963564173170124332641627169399852304611511887521527613858208776877706934034658839028986454686812721986441576582538345640083288494377295752136545030030378845647222986379656035835398148857804268458136966853832117064077363965110584146936510473620820871282616637067556761611627531675227320081363307277507286698878265502547270682650862708828)
        (ad 20513114107748916213404225865244788457074409421317268073736007022331351875833624862756219402282516605499234739123890210259042897848417665114604539868868273254948688298788998302213021613923064906756450800034198611450550412754819890990174752374167903316805361554027498760235600729993563831298333173441094727731923224830092028024856604134356448524792713778602056165546782663297074097079284342477853104853964497763641859184704167439137864700572855254893938640443507173796307557848785066207502084190070941243677848148415872970426984112227143138388781146980391816967852643014559749964089362445213740678445781520407345416931182699041155590319696207409023305181829071577033026467781464157778708535067535410514618107828410799078854809043994182182513891242966598128605638721171207590595334175915256179515795767729079909987621749163917687365458820366329459365528343025952159907952014278541741375614385752430254027787458039763962980148354021017595711354474983444535795390727075604793582413720611425701009821061847193862993314927110707228039583968452336179043689984205243355533686106965429229843687723310570965586179382872671178881510560063890749790799969604375110656863922578399537470723920490589304812587620853690645052574500291509160991572359900940420724641176985308557030554912090272478685362502316357934024797972855044761873086094428264355950862436019798203732663793722180258524408701122357905680756259238827164553903541080614504438587683436150871685884268883283911854170592499833400902456121829220126566671137352815854372233474135278712361983897095540626421407462186513362543785344229962579231578886782545540253824395033344947140802911329621494871150797172785087252655178157292521158795162751736228321379594242640753289713774813788577182079164501873509243856938395077798238684195225086857610004547607931023719346097561632391139975815092002982975159546683160426362246955972077936658217594864092323585697829920668939829394800301107410233703599100424307946464487800029921136792727516126004924528206024989173681199190467183044174366289573226993387328796686353001262094065886677828612237553191296728467686124117645915020679885821098583880459512400005399643605438196485962638776350246725512917429760098432821130792531585302118917535837554162150451664904547053284426081154205894049283709132043472492948062433231732886890323081803717104257817546161455251910978584912564590124304484825003663209179656643588909568838436967306030449237270646752767124447743338839118234701364264756637068592181857304587935081380346741935676377777738000391654868635675482278059571682109768442900093568916953814629840854483385045234030286006852324973600582554130111693028897769906912575142665730244531455877465249521338449046855843855835695525125243807274003500298341019159598027990797824307900319150505057082890499198084718553708432933227009336155667500047178145987247945476571211248754056910790992752991755636297837275630733526771844363248887124090245941209079831661430017567282457161714201881877508564203445830784748962887859489164006718845423665056853294160573803367220078511760896875018875436265794666526797116713991)
        (bn 18679644232137694835773895789796935368277093319442347009882028895983636202845338609238192673627146497565928042387055224157574139050288826655862246758264677614448028402353844741710560974837728602947105854327615172777677807366701532505782053272007434767818839012955843675198432125954639704393332610481612266824735837213574122272690607379032167676488469612066394795256393456323115729874647307324022050094919570365558303290939751605851466337737809073009233406468650259124598268624411389241168196985092309722980787131179252290893559312026443285238855953743578446404260697683876718720243998070208963196110161880695659120258496298742068955177202297231221854713889514939341338710288466093793249620509478542499217270116943730534610528631414218420777365890198159419904789404544815594578693254741245950839290769417056174832288369376710235014676146147468633129018928427491168063325782948815792849178692928887382135434681729289287967337075439807692747252894555096464608468870770272306141894543939790457871582280905906502647124459402979133843083046084613148746238605877442222978217173864099311407377701093864103693585496264088046841197293166458333808109330897750695971436430929379693868141924159750578349474196528735831027022930710200698011465050411238305883665750989820947782615767690752174603656863655235695510372750031379950324783924993662562999898391005787288706074052766163310550368263948617871014791452525375381426803827826752927165103290925907171678884968925213591369800936425974016544201074162690808540744854897729680887261315804116938589922540061828019386378590167985023192456982368984194146169494610555807299338947249571398537979070473103314582346674210413883618845411747108357789193206528225060723206424692411535736636880124631856413786992405295584419830157311803942862853074313776159067194511528927928414266465879542622955788891440153638676754727239764508736989303091478159209924874227484028795818451610680606439970077540524099704206162370096870622410572956084155250617029486154870570966638812142456113480214174492723144414953252009715373131781710069274723880618136495090451070098583243662797572407241313286841653442689485898363388204083005649951198361398468612590147786690372977367193534838948182349778146464897378808482133163629825944522445704281495970890808554290254714873933391569033738861111337892983959660609734480992012993277433865997793175736326621314652898038483105812001022395450458749805256561238577572040146462804577251468325598886411516301289338452351467886537896065545021406988061091200941643057561971430385531845109791470909518930415984599441096465126692173387505995283866721562382544618237963718834045094760633539051908412566846285956073333799948712666521093676261861167303418973611709249741242454070021816184150635280988297097917463890986448016624789958062269731291092669270798993316373736592456861706792773261332823061122660874852391531335207185069468318947590952403786907139751917687296093870144147055137535538562666514450751236638639254714837540658351799195360032379598389809413531717309390498240542341409517870564609553438235694303893655478920111421329599854382059)
        (bd 35047375165067289478184579374088753519723409541358727851367833378045381161956857862822162664157407750114046088766861757768628361860450858550612162200604740528020549735526868301563450011458255876617372435581481413877626213584152958947512852610351865749619221182400335300981664095326585454825312297691968407481156213225240040259895631250587691435815407287057903383853149474327315762925358991507160427907888884554569193526587056400916286053773407408865362995781271043549911925410762585516917061851141429216498699036671966534807428201871680758644707869709055458345849760857447496997369459512430997600004647049262418108322920507202971361167434749566827221165629531524830063260150702915506513004140215619053251853221128227039573877830371056963496851061915005076713551938040426681835756484540822137833583839287273858119692954255679012880175954568099315917680559792168668290774115965992289930491245825501336418496149153195257486784214896251536902218095859878825175930104814002335186480516826697953970017283350762453123058826001074995827392758721263396789788171838854949995547275268946535021565360713052629801500761448894400314861354423310859391743686807240892514171117787583263534162869357320748877744731428554325911583092674254089309526792474206410123702980303052860969897399493933015372688281452770610307341291480264049601427255610847963613178959192364378622499160842253921207881626181581709855849432538739896839132656376924833085425334004208124463768334575132431712512267775703706491862340888727839505443433268529379987084625482496093787809074752688019948611710332687765927010511936393170622967393012885553949858840148946705853974220230333552679372649812288028205467991322591700053013007905861724568610606853496128017958814314450986832892988026223481899589331851816885128871124803692166197269829726785503967919268160500701435937831624617814093029450809869946138434889833384333032268194378347437153894298364527885530000640988674907753972046462491022827738005865076839138904283740722398989182880398823501150929948982395291592901295075465416607929007655790650722355676164182368279922022441635530379579396127841519540366765299138907464310936858631412869302144760544631722698855436241594426632799148068619791910004407651630129367721152620976432342245466252584851082147635414151337510386583270139031454475785430451613760410780963926233601058128946480944715083701501658239619004129521741582609884569752285592082229894073389739632290612979527960898956998537733110196762265428813645010248053457222143316651370707088803028348532186655314492324589438375979080705908912991001132757969685814749516624261196677521777688416066667857217162155509052884746889529221826307232465665939634819692653774644615752505524321373928021711308907637490611431718655229495166013973268494159392003260853439666992720242593681536443289086106672585130316509972729860170549253311425331179571717512946796316828551789499616649200744710228301066546180726362338960578934089254316390186365586939632431422116920095304572927553904681045284800605022616383305331739050601840250168653669981271907611676558111666927724598500621490620608))
    (is (= (+ (/ an ad) (/ bn bd))
           (sb-gmp:mpq-add (/ an ad) (/ bn bd))))))
